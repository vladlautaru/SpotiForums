{"ast":null,"code":"//  SPDX-License-Identifier: LGPL-2.1-or-later\n//  Copyright (c) 2015-2024 MariaDB Corporation Ab\n\nconst PluginAuth = require('./plugin-auth');\n\n/**\n * Use PAM authentication\n */\nclass PamPasswordAuth extends PluginAuth {\n  constructor(packSeq, compressPackSeq, pluginData, cmdParam, reject, multiAuthResolver) {\n    super(cmdParam, multiAuthResolver, reject);\n    this.pluginData = pluginData;\n    this.sequenceNo = packSeq;\n    this.compressSequenceNo = compressPackSeq;\n    this.counter = 0;\n    this.multiAuthResolver = multiAuthResolver;\n  }\n  start(out, opts, info) {\n    this.exchange(this.pluginData, out, opts, info);\n    this.onPacketReceive = this.response;\n  }\n  exchange(buffer, out, opts, info) {\n    //conversation is :\n    // - first byte is information tell if question is a password (4) or clear text (2).\n    // - other bytes are the question to user\n\n    out.startPacket(this);\n    let pwd;\n    if (Array.isArray(opts.password)) {\n      pwd = opts.password[this.counter];\n      this.counter++;\n    } else {\n      pwd = opts.password;\n    }\n    if (pwd) out.writeString(pwd);\n    out.writeInt8(0);\n    out.flushPacket();\n  }\n  response(packet, out, opts, info) {\n    const marker = packet.peek();\n    switch (marker) {\n      //*********************************************************************************************************\n      //* OK_Packet and Err_Packet ending packet\n      //*********************************************************************************************************\n      case 0x00:\n      case 0xff:\n        this.emit('send_end');\n        return this.multiAuthResolver(packet, out, opts, info);\n      default:\n        let promptData = packet.readBuffer();\n        this.exchange(promptData, out, opts, info);\n        this.onPacketReceive = this.response;\n    }\n  }\n}\nmodule.exports = PamPasswordAuth;","map":{"version":3,"names":["PluginAuth","require","PamPasswordAuth","constructor","packSeq","compressPackSeq","pluginData","cmdParam","reject","multiAuthResolver","sequenceNo","compressSequenceNo","counter","start","out","opts","info","exchange","onPacketReceive","response","buffer","startPacket","pwd","Array","isArray","password","writeString","writeInt8","flushPacket","packet","marker","peek","emit","promptData","readBuffer","module","exports"],"sources":["D:/Ale lui Vlad/Projects/SpotiForums/spotiforums/node_modules/mariadb/lib/cmd/handshake/auth/pam-password-auth.js"],"sourcesContent":["//  SPDX-License-Identifier: LGPL-2.1-or-later\n//  Copyright (c) 2015-2024 MariaDB Corporation Ab\n\nconst PluginAuth = require('./plugin-auth');\n\n/**\n * Use PAM authentication\n */\nclass PamPasswordAuth extends PluginAuth {\n  constructor(packSeq, compressPackSeq, pluginData, cmdParam, reject, multiAuthResolver) {\n    super(cmdParam, multiAuthResolver, reject);\n    this.pluginData = pluginData;\n    this.sequenceNo = packSeq;\n    this.compressSequenceNo = compressPackSeq;\n    this.counter = 0;\n    this.multiAuthResolver = multiAuthResolver;\n  }\n\n  start(out, opts, info) {\n    this.exchange(this.pluginData, out, opts, info);\n    this.onPacketReceive = this.response;\n  }\n\n  exchange(buffer, out, opts, info) {\n    //conversation is :\n    // - first byte is information tell if question is a password (4) or clear text (2).\n    // - other bytes are the question to user\n\n    out.startPacket(this);\n\n    let pwd;\n    if (Array.isArray(opts.password)) {\n      pwd = opts.password[this.counter];\n      this.counter++;\n    } else {\n      pwd = opts.password;\n    }\n\n    if (pwd) out.writeString(pwd);\n    out.writeInt8(0);\n    out.flushPacket();\n  }\n\n  response(packet, out, opts, info) {\n    const marker = packet.peek();\n    switch (marker) {\n      //*********************************************************************************************************\n      //* OK_Packet and Err_Packet ending packet\n      //*********************************************************************************************************\n      case 0x00:\n      case 0xff:\n        this.emit('send_end');\n        return this.multiAuthResolver(packet, out, opts, info);\n\n      default:\n        let promptData = packet.readBuffer();\n        this.exchange(promptData, out, opts, info);\n        this.onPacketReceive = this.response;\n    }\n  }\n}\n\nmodule.exports = PamPasswordAuth;\n"],"mappings":"AAAA;AACA;;AAEA,MAAMA,UAAU,GAAGC,OAAO,CAAC,eAAe,CAAC;;AAE3C;AACA;AACA;AACA,MAAMC,eAAe,SAASF,UAAU,CAAC;EACvCG,WAAWA,CAACC,OAAO,EAAEC,eAAe,EAAEC,UAAU,EAAEC,QAAQ,EAAEC,MAAM,EAAEC,iBAAiB,EAAE;IACrF,KAAK,CAACF,QAAQ,EAAEE,iBAAiB,EAAED,MAAM,CAAC;IAC1C,IAAI,CAACF,UAAU,GAAGA,UAAU;IAC5B,IAAI,CAACI,UAAU,GAAGN,OAAO;IACzB,IAAI,CAACO,kBAAkB,GAAGN,eAAe;IACzC,IAAI,CAACO,OAAO,GAAG,CAAC;IAChB,IAAI,CAACH,iBAAiB,GAAGA,iBAAiB;EAC5C;EAEAI,KAAKA,CAACC,GAAG,EAAEC,IAAI,EAAEC,IAAI,EAAE;IACrB,IAAI,CAACC,QAAQ,CAAC,IAAI,CAACX,UAAU,EAAEQ,GAAG,EAAEC,IAAI,EAAEC,IAAI,CAAC;IAC/C,IAAI,CAACE,eAAe,GAAG,IAAI,CAACC,QAAQ;EACtC;EAEAF,QAAQA,CAACG,MAAM,EAAEN,GAAG,EAAEC,IAAI,EAAEC,IAAI,EAAE;IAChC;IACA;IACA;;IAEAF,GAAG,CAACO,WAAW,CAAC,IAAI,CAAC;IAErB,IAAIC,GAAG;IACP,IAAIC,KAAK,CAACC,OAAO,CAACT,IAAI,CAACU,QAAQ,CAAC,EAAE;MAChCH,GAAG,GAAGP,IAAI,CAACU,QAAQ,CAAC,IAAI,CAACb,OAAO,CAAC;MACjC,IAAI,CAACA,OAAO,EAAE;IAChB,CAAC,MAAM;MACLU,GAAG,GAAGP,IAAI,CAACU,QAAQ;IACrB;IAEA,IAAIH,GAAG,EAAER,GAAG,CAACY,WAAW,CAACJ,GAAG,CAAC;IAC7BR,GAAG,CAACa,SAAS,CAAC,CAAC,CAAC;IAChBb,GAAG,CAACc,WAAW,CAAC,CAAC;EACnB;EAEAT,QAAQA,CAACU,MAAM,EAAEf,GAAG,EAAEC,IAAI,EAAEC,IAAI,EAAE;IAChC,MAAMc,MAAM,GAAGD,MAAM,CAACE,IAAI,CAAC,CAAC;IAC5B,QAAQD,MAAM;MACZ;MACA;MACA;MACA,KAAK,IAAI;MACT,KAAK,IAAI;QACP,IAAI,CAACE,IAAI,CAAC,UAAU,CAAC;QACrB,OAAO,IAAI,CAACvB,iBAAiB,CAACoB,MAAM,EAAEf,GAAG,EAAEC,IAAI,EAAEC,IAAI,CAAC;MAExD;QACE,IAAIiB,UAAU,GAAGJ,MAAM,CAACK,UAAU,CAAC,CAAC;QACpC,IAAI,CAACjB,QAAQ,CAACgB,UAAU,EAAEnB,GAAG,EAAEC,IAAI,EAAEC,IAAI,CAAC;QAC1C,IAAI,CAACE,eAAe,GAAG,IAAI,CAACC,QAAQ;IACxC;EACF;AACF;AAEAgB,MAAM,CAACC,OAAO,GAAGlC,eAAe","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}