{"ast":null,"code":"//  SPDX-License-Identifier: LGPL-2.1-or-later\n//  Copyright (c) 2015-2024 MariaDB Corporation Ab\n\n'use strict';\n\nconst Command = require('./command');\nconst ServerStatus = require('../const/server-status');\nconst PING_COMMAND = new Uint8Array([1, 0, 0, 0, 0x0e]);\n\n/**\n * send a COM_PING: permits sending a packet containing one byte to check that the connection is active.\n * see https://mariadb.com/kb/en/library/com_ping/\n */\nclass Ping extends Command {\n  constructor(cmdParam, resolve, reject) {\n    super(cmdParam, resolve, reject);\n  }\n  start(out, opts, info) {\n    if (opts.logger.query) opts.logger.query('PING');\n    this.onPacketReceive = this.readPingResponsePacket;\n    out.fastFlush(this, PING_COMMAND);\n    this.emit('send_end');\n  }\n\n  /**\n   * Read ping response packet.\n   * packet can be :\n   * - an ERR_Packet\n   * - an OK_Packet\n   *\n   * @param packet  query response\n   * @param out     output writer\n   * @param opts    connection options\n   * @param info    connection info\n   */\n  readPingResponsePacket(packet, out, opts, info) {\n    packet.skip(1); //skip header\n    packet.skipLengthCodedNumber(); //affected rows\n    packet.skipLengthCodedNumber(); //insert ids\n    info.status = packet.readUInt16();\n    if (info.redirectRequest && (info.status & ServerStatus.STATUS_IN_TRANS) === 0) {\n      info.redirect(info.redirectRequest, this.successEnd.bind(this, null));\n    } else {\n      this.successEnd(null);\n    }\n  }\n}\nmodule.exports = Ping;","map":{"version":3,"names":["Command","require","ServerStatus","PING_COMMAND","Uint8Array","Ping","constructor","cmdParam","resolve","reject","start","out","opts","info","logger","query","onPacketReceive","readPingResponsePacket","fastFlush","emit","packet","skip","skipLengthCodedNumber","status","readUInt16","redirectRequest","STATUS_IN_TRANS","redirect","successEnd","bind","module","exports"],"sources":["D:/Ale lui Vlad/Projects/SpotiForums/spotiforums/node_modules/mariadb/lib/cmd/ping.js"],"sourcesContent":["//  SPDX-License-Identifier: LGPL-2.1-or-later\n//  Copyright (c) 2015-2024 MariaDB Corporation Ab\n\n'use strict';\n\nconst Command = require('./command');\nconst ServerStatus = require('../const/server-status');\n\nconst PING_COMMAND = new Uint8Array([1, 0, 0, 0, 0x0e]);\n\n/**\n * send a COM_PING: permits sending a packet containing one byte to check that the connection is active.\n * see https://mariadb.com/kb/en/library/com_ping/\n */\nclass Ping extends Command {\n  constructor(cmdParam, resolve, reject) {\n    super(cmdParam, resolve, reject);\n  }\n\n  start(out, opts, info) {\n    if (opts.logger.query) opts.logger.query('PING');\n    this.onPacketReceive = this.readPingResponsePacket;\n    out.fastFlush(this, PING_COMMAND);\n    this.emit('send_end');\n  }\n\n  /**\n   * Read ping response packet.\n   * packet can be :\n   * - an ERR_Packet\n   * - an OK_Packet\n   *\n   * @param packet  query response\n   * @param out     output writer\n   * @param opts    connection options\n   * @param info    connection info\n   */\n  readPingResponsePacket(packet, out, opts, info) {\n    packet.skip(1); //skip header\n    packet.skipLengthCodedNumber(); //affected rows\n    packet.skipLengthCodedNumber(); //insert ids\n    info.status = packet.readUInt16();\n    if (info.redirectRequest && (info.status & ServerStatus.STATUS_IN_TRANS) === 0) {\n      info.redirect(info.redirectRequest, this.successEnd.bind(this, null));\n    } else {\n      this.successEnd(null);\n    }\n  }\n}\n\nmodule.exports = Ping;\n"],"mappings":"AAAA;AACA;;AAEA,YAAY;;AAEZ,MAAMA,OAAO,GAAGC,OAAO,CAAC,WAAW,CAAC;AACpC,MAAMC,YAAY,GAAGD,OAAO,CAAC,wBAAwB,CAAC;AAEtD,MAAME,YAAY,GAAG,IAAIC,UAAU,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;;AAEvD;AACA;AACA;AACA;AACA,MAAMC,IAAI,SAASL,OAAO,CAAC;EACzBM,WAAWA,CAACC,QAAQ,EAAEC,OAAO,EAAEC,MAAM,EAAE;IACrC,KAAK,CAACF,QAAQ,EAAEC,OAAO,EAAEC,MAAM,CAAC;EAClC;EAEAC,KAAKA,CAACC,GAAG,EAAEC,IAAI,EAAEC,IAAI,EAAE;IACrB,IAAID,IAAI,CAACE,MAAM,CAACC,KAAK,EAAEH,IAAI,CAACE,MAAM,CAACC,KAAK,CAAC,MAAM,CAAC;IAChD,IAAI,CAACC,eAAe,GAAG,IAAI,CAACC,sBAAsB;IAClDN,GAAG,CAACO,SAAS,CAAC,IAAI,EAAEf,YAAY,CAAC;IACjC,IAAI,CAACgB,IAAI,CAAC,UAAU,CAAC;EACvB;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEF,sBAAsBA,CAACG,MAAM,EAAET,GAAG,EAAEC,IAAI,EAAEC,IAAI,EAAE;IAC9CO,MAAM,CAACC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;IAChBD,MAAM,CAACE,qBAAqB,CAAC,CAAC,CAAC,CAAC;IAChCF,MAAM,CAACE,qBAAqB,CAAC,CAAC,CAAC,CAAC;IAChCT,IAAI,CAACU,MAAM,GAAGH,MAAM,CAACI,UAAU,CAAC,CAAC;IACjC,IAAIX,IAAI,CAACY,eAAe,IAAI,CAACZ,IAAI,CAACU,MAAM,GAAGrB,YAAY,CAACwB,eAAe,MAAM,CAAC,EAAE;MAC9Eb,IAAI,CAACc,QAAQ,CAACd,IAAI,CAACY,eAAe,EAAE,IAAI,CAACG,UAAU,CAACC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;IACvE,CAAC,MAAM;MACL,IAAI,CAACD,UAAU,CAAC,IAAI,CAAC;IACvB;EACF;AACF;AAEAE,MAAM,CAACC,OAAO,GAAG1B,IAAI","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}