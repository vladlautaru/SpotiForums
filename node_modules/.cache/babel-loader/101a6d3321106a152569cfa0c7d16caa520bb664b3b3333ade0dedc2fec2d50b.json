{"ast":null,"code":"//  SPDX-License-Identifier: LGPL-2.1-or-later\n//  Copyright (c) 2015-2024 MariaDB Corporation Ab\n\n'use strict';\n\nconst CommandParameter = require('../../command-parameter');\nconst Errors = require('../../misc/errors');\nconst ExecuteStream = require('../execute-stream');\nconst Parser = require('../parser');\n\n/**\n * Prepare result\n * see https://mariadb.com/kb/en/com_stmt_prepare/#com_stmt_prepare_ok\n */\nclass PrepareResultPacket {\n  #conn;\n  constructor(statementId, parameterCount, columns, database, sql, placeHolderIndex, conn) {\n    this.id = statementId;\n    this.parameterCount = parameterCount;\n    this.columns = columns;\n    this.database = database;\n    this.query = sql;\n    this.closed = false;\n    this._placeHolderIndex = placeHolderIndex;\n    this.#conn = conn;\n  }\n  get conn() {\n    return this.#conn;\n  }\n  execute(values, opts, cb, stack) {\n    let _opts = opts,\n      _cb = cb;\n    if (typeof _opts === 'function') {\n      _cb = _opts;\n      _opts = undefined;\n    }\n    if (this.isClose()) {\n      let sql = this.query;\n      if (this.conn.opts.logParam) {\n        if (this.query.length > this.conn.opts.debugLen) {\n          sql = this.query.substring(0, this.conn.opts.debugLen) + '...';\n        } else {\n          let sqlMsg = this.query + ' - parameters:';\n          sql = Parser.logParameters(this.conn.opts, sqlMsg, values);\n        }\n      }\n      const error = Errors.createError(`Execute fails, prepare command as already been closed`, Errors.ER_PREPARE_CLOSED, null, '22000', sql);\n      if (!_cb) {\n        return Promise.reject(error);\n      } else {\n        _cb(error);\n        return;\n      }\n    }\n    const cmdParam = new CommandParameter(this.query, values, _opts, _cb);\n    if (stack) cmdParam.stack = stack;\n    const conn = this.conn;\n    const promise = new Promise((resolve, reject) => conn.executePromise.call(conn, cmdParam, this, resolve, reject));\n    if (!_cb) {\n      return promise;\n    } else {\n      promise.then(res => {\n        if (_cb) _cb(null, res, null);\n      }).catch(_cb || function (err) {});\n    }\n  }\n  executeStream(values, opts, cb, stack) {\n    let _opts = opts,\n      _cb = cb;\n    if (typeof _opts === 'function') {\n      _cb = _opts;\n      _opts = undefined;\n    }\n    if (this.isClose()) {\n      const error = Errors.createError(`Execute fails, prepare command as already been closed`, Errors.ER_PREPARE_CLOSED, null, '22000', this.query);\n      if (!_cb) {\n        throw error;\n      } else {\n        _cb(error);\n        return;\n      }\n    }\n    const cmdParam = new CommandParameter(this.query, values, _opts, _cb);\n    if (stack) cmdParam.stack = stack;\n    const cmd = new ExecuteStream(cmdParam, this.conn.opts, this, this.conn.socket);\n    if (this.conn.opts.logger.error) cmd.on('error', this.conn.opts.logger.error);\n    this.conn.addCommand(cmd);\n    return cmd.inStream;\n  }\n  isClose() {\n    return this.closed;\n  }\n  close() {\n    if (!this.closed) {\n      this.closed = true;\n      this.#conn.emit('close_prepare', this);\n    }\n  }\n  toString() {\n    return 'Prepare{closed:' + this.closed + '}';\n  }\n}\nmodule.exports = PrepareResultPacket;","map":{"version":3,"names":["CommandParameter","require","Errors","ExecuteStream","Parser","PrepareResultPacket","conn","constructor","statementId","parameterCount","columns","database","sql","placeHolderIndex","id","query","closed","_placeHolderIndex","execute","values","opts","cb","stack","_opts","_cb","undefined","isClose","logParam","length","debugLen","substring","sqlMsg","logParameters","error","createError","ER_PREPARE_CLOSED","Promise","reject","cmdParam","promise","resolve","executePromise","call","then","res","catch","err","executeStream","cmd","socket","logger","on","addCommand","inStream","close","emit","toString","module","exports"],"sources":["D:/Ale lui Vlad/Projects/SpotiForums/spotiforums/node_modules/mariadb/lib/cmd/class/prepare-result-packet.js"],"sourcesContent":["//  SPDX-License-Identifier: LGPL-2.1-or-later\n//  Copyright (c) 2015-2024 MariaDB Corporation Ab\n\n'use strict';\nconst CommandParameter = require('../../command-parameter');\nconst Errors = require('../../misc/errors');\nconst ExecuteStream = require('../execute-stream');\nconst Parser = require('../parser');\n\n/**\n * Prepare result\n * see https://mariadb.com/kb/en/com_stmt_prepare/#com_stmt_prepare_ok\n */\nclass PrepareResultPacket {\n  #conn;\n  constructor(statementId, parameterCount, columns, database, sql, placeHolderIndex, conn) {\n    this.id = statementId;\n    this.parameterCount = parameterCount;\n    this.columns = columns;\n    this.database = database;\n    this.query = sql;\n    this.closed = false;\n    this._placeHolderIndex = placeHolderIndex;\n    this.#conn = conn;\n  }\n\n  get conn() {\n    return this.#conn;\n  }\n\n  execute(values, opts, cb, stack) {\n    let _opts = opts,\n      _cb = cb;\n\n    if (typeof _opts === 'function') {\n      _cb = _opts;\n      _opts = undefined;\n    }\n\n    if (this.isClose()) {\n      let sql = this.query;\n      if (this.conn.opts.logParam) {\n        if (this.query.length > this.conn.opts.debugLen) {\n          sql = this.query.substring(0, this.conn.opts.debugLen) + '...';\n        } else {\n          let sqlMsg = this.query + ' - parameters:';\n          sql = Parser.logParameters(this.conn.opts, sqlMsg, values);\n        }\n      }\n\n      const error = Errors.createError(\n        `Execute fails, prepare command as already been closed`,\n        Errors.ER_PREPARE_CLOSED,\n        null,\n        '22000',\n        sql\n      );\n\n      if (!_cb) {\n        return Promise.reject(error);\n      } else {\n        _cb(error);\n        return;\n      }\n    }\n\n    const cmdParam = new CommandParameter(this.query, values, _opts, _cb);\n    if (stack) cmdParam.stack = stack;\n    const conn = this.conn;\n    const promise = new Promise((resolve, reject) => conn.executePromise.call(conn, cmdParam, this, resolve, reject));\n    if (!_cb) {\n      return promise;\n    } else {\n      promise\n        .then((res) => {\n          if (_cb) _cb(null, res, null);\n        })\n        .catch(_cb || function (err) {});\n    }\n  }\n\n  executeStream(values, opts, cb, stack) {\n    let _opts = opts,\n      _cb = cb;\n\n    if (typeof _opts === 'function') {\n      _cb = _opts;\n      _opts = undefined;\n    }\n\n    if (this.isClose()) {\n      const error = Errors.createError(\n        `Execute fails, prepare command as already been closed`,\n        Errors.ER_PREPARE_CLOSED,\n        null,\n        '22000',\n        this.query\n      );\n\n      if (!_cb) {\n        throw error;\n      } else {\n        _cb(error);\n        return;\n      }\n    }\n\n    const cmdParam = new CommandParameter(this.query, values, _opts, _cb);\n    if (stack) cmdParam.stack = stack;\n\n    const cmd = new ExecuteStream(cmdParam, this.conn.opts, this, this.conn.socket);\n    if (this.conn.opts.logger.error) cmd.on('error', this.conn.opts.logger.error);\n    this.conn.addCommand(cmd);\n    return cmd.inStream;\n  }\n\n  isClose() {\n    return this.closed;\n  }\n\n  close() {\n    if (!this.closed) {\n      this.closed = true;\n      this.#conn.emit('close_prepare', this);\n    }\n  }\n  toString() {\n    return 'Prepare{closed:' + this.closed + '}';\n  }\n}\n\nmodule.exports = PrepareResultPacket;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}